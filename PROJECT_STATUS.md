# YXT Manual T0 Collaboration - 项目状态

**更新时间**: 2026-02-28 15:00  
**版本**: v0.2.0  
**状态**: 开发中  
**阶段**: 核心功能完成 → 测试阶段

---

## 📊 整体进度

**完成度**: 70%

```
[███████████████-----] 70%
```

### 阶段划分

- ✅ **阶段 1: 核心功能** (100%) - 已完成
- 🔄 **阶段 2: 测试** (0%) - 进行中
- ⏳ **阶段 3: 文档** (0%) - 待开始
- ⏳ **阶段 4: 优化** (0%) - 待开始

---

## ✅ 阶段 1: 核心功能 (已完成)

### 1.1 DBF 预埋单解析模块 ✅

**文件**: `src/dbf_parser.py` (350 行)

**功能**:
- [x] 支持迅投 PB-DBF V2.15 规范的 17 个字段
- [x] 列名智能映射（中文↔英文）
- [x] 数据验证（证券代码、数量、价格类型）
- [x] 支持 DBF/Excel/CSV 三种格式
- [x] 订单筛选（按股票、账户、买卖方向）
- [x] 错误处理和日志记录

**支持字段**:
| 字段 | 说明 | 必填 |
|------|------|------|
| order_type | 下单类型 | Y |
| price_type | 委托价格类型 | Y |
| stock_code | 证券代码 | Y |
| volume | 委托数量 | Y |
| account_id | 资金账号 | Y |
| mode_price | 委托价格 | N |
| strategy | 策略备注 | N |
| tradeparam | 交易参数 | N |
| basketpath | 组合交易文件路径 | N |
| batch_id | 批次 ID | N |
| ... | ... | ... |

### 1.2 仓位计算核心模块 ✅

**文件**: `src/position_calc.py` (320 行)

**功能**:
- [x] 基于成交记录的实际持仓计算
- [x] 基于订单的估算持仓（无成交时）
- [x] 多账户/多策略支持
- [x] 实时盈亏计算
- [x] 冻结仓位管理
- [x] T0 仓位配对计算
- [x] 批次合并支持
- [x] Excel 报告导出

**计算逻辑**:
```
持仓 = 买入成交 - 卖出成交
可用 = 持仓 - 冻结
冻结 = 未成交委托数量
市值 = 持仓 × 当前价格
盈亏 = (当前价 - 成本价) × 持仓
```

### 1.3 T0 策略引擎 ✅

**文件**: `src/t0_strategy.py` (180 行)

**功能**:
- [x] T0 待完成配对信号生成
- [x] 底仓做 T 策略
- [x] 信号优先级管理（1-5 级）
- [x] 可配置策略参数
- [x] T0 盈亏计算

**策略类型**:
1. **待完成配对** (优先级 2)
   - 买入>卖出 → 生成卖出信号
   - 卖出>买入 → 生成买入信号

2. **底仓做 T** (优先级 3)
   - 检查可用底仓
   - 生成高抛信号
   - 控制 T0 比例

**参数配置**:
```python
{
    'sell_premium': 0.002,      # 卖出溢价 0.2%
    'buy_discount': 0.002,      # 买入折价 0.2%
    'min_t0_volume': 100,       # 最小 T0 数量
    'max_t0_ratio': 0.5,        # 最大 T0 比例
}
```

### 1.4 风险控制模块 ✅

**文件**: `src/risk_check.py` (180 行)

**功能**:
- [x] 总仓位限额检查
- [x] 单票集中度检查
- [x] 盈亏止损/止盈检查
- [x] 三级告警系统

**风险参数**:
```python
{
    'max_total_position': 10000000,    # 最大总仓位 1000 万
    'max_single_stock_ratio': 0.2,     # 单票最大 20%
    'stop_loss_ratio': -0.05,          # 止损线 -5%
    'take_profit_ratio': 0.1,          # 止盈线 10%
}
```

**告警级别**:
- ERROR - 阻断性风险（超限）
- WARNING - 警告（接近阈值）
- INFO - 提示（达到止盈）

### 1.5 主入口程序 ✅

**文件**: `src/main.py` (100 行)

**功能**:
- [x] 命令行接口
- [x] 完整处理流程
- [x] 进度输出
- [x] 报告导出

**使用方式**:
```bash
python src/main.py -i data/orders.xlsx -o reports/report.xlsx
```

---

## 🔄 阶段 2: 测试 (进行中)

### 2.1 单元测试 (0%)

- [ ] `test_dbf_parser.py`
  - [ ] 测试 DBF 文件解析
  - [ ] 测试 Excel 文件解析
  - [ ] 测试 CSV 文件解析
  - [ ] 测试列名映射
  - [ ] 测试数据验证

- [ ] `test_position_calc.py`
  - [ ] 测试持仓计算
  - [ ] 测试 T0 配对
  - [ ] 测试盈亏计算
  - [ ] 测试批次合并

- [ ] `test_t0_strategy.py`
  - [ ] 测试信号生成
  - [ ] 测试优先级排序
  - [ ] 测试策略参数

- [ ] `test_risk_check.py`
  - [ ] 测试仓位限额
  - [ ] 测试集中度
  - [ ] 测试止损止盈

### 2.2 样例数据 (0%)

- [ ] `data/sample_orders.xlsx` - 测试订单
- [ ] `data/sample_trades.csv` - 测试成交
- [ ] `data/sample_prices.json` - 测试价格

### 2.3 集成测试 (0%)

- [ ] 完整流程测试
- [ ] 边界条件测试
- [ ] 异常处理测试

---

## ⏳ 阶段 3: 文档 (待开始)

- [ ] API 文档 (`docs/API.md`)
- [ ] 使用指南 (`docs/USAGE.md`)
- [ ] 部署说明 (`docs/DEPLOY.md`)
- [ ] 更新日志 (`CHANGELOG.md`)

---

## ⏳ 阶段 4: 优化 (待开始)

- [ ] 性能优化
  - [ ] 大数据集处理优化
  - [ ] 缓存机制
- [ ] 代码重构
  - [ ] 提取公共逻辑
  - [ ] 优化类结构
- [ ] 功能增强
  - [ ] 更多风险检查项
  - [ ] 更多策略类型
  - [ ] 图形界面（可选）

---

## 📁 项目结构

```
YXTManualT0Collaboration/
├── src/
│   ├── __init__.py          # 模块初始化
│   ├── dbf_parser.py        # DBF 解析器 (350 行)
│   ├── position_calc.py     # 仓位计算 (320 行)
│   ├── t0_strategy.py       # T0 策略 (180 行)
│   ├── risk_check.py        # 风险控制 (180 行)
│   └── main.py              # 主入口 (100 行)
├── tests/
│   ├── __init__.py
│   ├── test_dbf_parser.py   # 待完成
│   ├── test_position_calc.py # 待完成
│   └── test_t0_strategy.py  # 待完成
├── data/
│   └── (样例数据)           # 待创建
├── docs/
│   ├── API.md               # 待创建
│   └── USAGE.md             # 待创建
├── PROJECT_STATUS.md        # 本文件
├── README.md                # 项目说明
├── requirements.txt         # Python 依赖
├── .env.example             # 配置模板
└── .gitignore               # Git 忽略
```

---

## 🔗 重要链接

### 设计文档
- **手动 T0 实施方案**: https://zwtkt4hydpt.feishu.cn/wiki/Uj7pwYKiliQcb2k0W7gcis4pnde
- **迅投 DBF 参数说明**: 已上传 Excel (`迅投 PB-DBF 预埋单参数说明文档 V2.15(1).xlsx`)

### 代码仓库
- **GitHub**: https://github.com/YoungManLin/YXTManualT0Collaboration
- **最新提交**: 536de73 - docs: 添加项目状态文档

### 配置信息
- **配置文档**: `/home/admin/.openclaw/workspace/memory/IMPORTANT_CONFIG.md`

---

## 📝 Git 提交历史

```
536de73 - docs: 添加项目状态文档 (2026-02-28)
ad0c2b5 - feat: 完善核心功能模块 (2026-02-28)
8c411fb - feat: 初始版本 (2026-02-28)
```

---

## 📊 技术指标

| 指标 | 数值 |
|------|------|
| 总代码量 | ~1,130 行 |
| 核心模块 | 5 个 |
| 测试覆盖 | 0% |
| Python 版本 | 3.12+ |
| 依赖包 | 7 个 |

---

## ⚠️ 已知问题

- 暂无

---

## 🎯 下一步计划

### 高优先级（本周）
1. [ ] 编写单元测试（目标覆盖 80%）
2. [ ] 创建样例数据文件
3. [ ] 运行集成测试

### 中优先级（下周）
1. [ ] 编写 API 文档
2. [ ] 编写使用指南
3. [ ] 代码审查和重构

### 低优先级（后续）
1. [ ] 性能优化
2. [ ] 功能增强
3. [ ] 图形界面（可选）

---

## 📅 里程碑

- ✅ **2026-02-28**: v0.1.0 - 初始版本
- ✅ **2026-02-28**: v0.2.0 - 核心功能完成
- 🎯 **2026-03-07**: v0.3.0 - 测试完成
- 🎯 **2026-03-14**: v1.0.0 - 正式发布

---

**下次更新**: 完成单元测试后  
**负责人**: Strategy Team  
**联系方式**: linyoungman3@gmail.com
